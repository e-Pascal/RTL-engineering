# Игра на ПЛИС

- [Теория](#теория)
  - [Что такое VGA и как оно работает](#что-такое-vga-и-как-оно-работает)
  - [Реализация VGA интерфейса на ПЛИС Nexys A7](#реализация-vga-интерфейса-на-плис-nexys-a7)
  - [Генерация сигнала VGA](#генерация-сигнала-vga)
- [Практика](#практика)

## Теория

Для FPGA существует определённая кривая обучаемости, потому что здесь вы разрабатываете схемы, а не пишете программное обеспечение, которое работает на процессоре. Но если вы с помощью FPGA можете заставить мигать пять светодиодов, то в целом готовы реализовать выдачу видеосигнала VGA. Формат видео VGA намного проще, чем вы думаете: всего три сигнала для пикселей (красный, зелёный и синий) и два сигнала для горизонтальной и вертикальной синхронизации.

## Что такое VGA и как оно работает

VGA (Video Graphics Array) является стандартом для аналоговой передачи видеосигнала на компьютерных мониторах. Этот стандарт был разработан компанией IBM в 1987 году и быстро стал популярным в мире компьютеров.

Работа VGA основана на передаче аналоговых сигналов для создания изображения на мониторе. Например, в компьютере формированием изображения занимается графическое ядро в центральном процессоре или дискретная видеокарта, генерирующие так называемые RGB-сигналы, которые представляют отдельные пиксели изображения. Каждый RGB-сигнал представлен отдельным аналоговым сигналом, который определяет яркость цвета для каждого пикселя изображения.

VGA-кабель передает RGB-сигналы от видеокарты к монитору. Кабель содержит несколько проводников для каждого цвета (красный, зеленый и синий), а также провод для горизонтальной и вертикальной синхронизации. Приемник на мониторе преобразует эти сигналы обратно в видеоизображение.

![pic/vga-pinout.jpg](pic/vga-pinout.jpg)

## Реализация VGA интерфейса на ПЛИС Nexys A7

Согласно [документации](https://digilent.com/reference/_media/reference/programmable-logic/nexys-a7/nexys-a7_rm.pdf) на ПЛИС Nexys-A7, к разъему [DE-15](https://ru.wikipedia.org/wiki/D-sub) (настоящее имя разъема к которому подключается провод от монитора, а VGA - лишь название графического интерфейса) к каждому из контактов, отвечающих за цвет, подходят по 4 сигнала, подключенных черех резисторы, тем самым позволяя реализовать различную яркость для каждого из цветов.

![pic/DE-15_FPGA.png](pic/DE-15_FPGA.png)

## Генерация сигнала VGA

Основная идея в том, чтобы использовать два счётчика: один для пикселей по горизонтали, а второй для горизонтальных линий. В каждой точке экрана по этим координатам генерируется нужный цвет пикселя. Кроме того, генерируются импульсы горизонтальной и вертикальной синхронизации, когда счётчики находятся в соответствующей позиции. Для реализации будем использовать базовое разрешение VGA 640x480@60Hz, где нужно вести отсчёт до 800 и 525. По горизонтали в каждой линии 800 пикселей: 640 видимых, 16 пустых, 96 на горизонтальную синхронизацию и ещё 48 пустых пикселей. (Такие странные параметры используются по историческим причинам). Между тем, вертикальный счётчик должен отсчитывать 525 линий: 480 линий изображения, 10 пустых, 2 линии вертикальной синхронизации и ещё 33 пустые.

![pic/Display_regions.png](pic/Display_regions.png)

## Практика

Выбор формата изображения VGA 640x480@60Hz обуславливается несколькими причинами: во-первых, на небольшом изображении проще контролировать ситуацию. Во-вторых, так как вывод изображения будет реализован посредством ПЛИС Nexys-A7 с внутренней частотой 100MHz, согласно [таймингам](http://tinyvga.com/vga-timing) для формирования сигналов, содержащих цвета пикселей, проще всего будет реализовать делитель частоты на 25MHz, что соответствует даному формату.

При создании проекта в САПР Vivado необходимо добавить файл [nexys_a7_100t.xdc](xdc/nexys_a7_100t.xdc) в Constraints проекта. В нем указаны использующиеся выводы ПЛИС и их название, которое будет фигурировать в исходниках проекта.

